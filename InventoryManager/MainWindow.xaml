<Window x:Class="InventoryManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:InventoryManager"
        mc:Ignorable="d"
        Title="Manajemen Inventaris Profesional" Height="720" Width="1280" WindowStartupLocation="CenterScreen"
        Background="#F0F2F5">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style x:Key="ToolBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0E0E0"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <DockPanel>
        <ToolBarTray DockPanel.Dock="Top" Background="White">
            <ToolBar>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="AddNewProductButton" Click="AddNewProductButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="➕" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Produk Baru"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="ManageBundleButton" Click="ManageBundleButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="🔗" FontSize="20" HorizontalAlignment="Center" Foreground="BlueViolet"/>
                        <TextBlock Text="Kelola Bundle"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="ManageUnitsButton" Click="ManageUnitsButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="📦" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Kelola Satuan"/>
                    </StackPanel>
                </Button>
                <Separator/>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="ToDoListButton" Click="ToDoListButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="📝" FontSize="20" HorizontalAlignment="Center" Foreground="Green"/>
                        <TextBlock Text="To-Do List" Foreground="Green"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="DataAnalysisButton" Click="DataAnalysisButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="🔍" FontSize="20" HorizontalAlignment="Center" Foreground="DarkGoldenrod"/>
                        <TextBlock Text="Analisis Data" Foreground="DarkGoldenrod"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="ViewReportsButton" Click="ViewReportsButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="📊" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Laporan"/>
                    </StackPanel>
                </Button>
                <Separator/>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="SaveChangesButton" Click="SaveChangesButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="💾" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Simpan"/>
                    </StackPanel>
                </Button>
            </ToolBar>
            <ToolBar>
                <Label Content="Cari:" VerticalAlignment="Center"/>
                <TextBox x:Name="SearchTextBox" Width="250" Margin="5" VerticalAlignment="Center" TextChanged="SearchTextBox_TextChanged" ToolTip="Cari berdasarkan Nama Produk, Nama Alternatif, atau Barcode Satuan"/>
                <Button Content="Reset" x:Name="ResetButton" Click="ResetButton_Click"/>
                <Separator Margin="10,0"/>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="PrintBarcodeButton" Click="PrintBarcodeButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="🖨️" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Cetak Barcode"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="PrintPriceLabelButton" Click="PrintPriceLabelButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="🏷️" FontSize="20" HorizontalAlignment="Center"/>
                        <TextBlock Text="Cetak Label Harga"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="DuplicateProductButton" Click="DuplicateProductButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="📋" FontSize="20" HorizontalAlignment="Center" Foreground="DodgerBlue"/>
                        <TextBlock Text="Duplikasi"/>
                    </StackPanel>
                </Button>
                <Button Style="{StaticResource ToolBarButtonStyle}" x:Name="DeleteProductButton" Click="DeleteProductButton_Click">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                        <TextBlock Text="❌" FontSize="20" HorizontalAlignment="Center" Foreground="IndianRed"/>
                        <TextBlock Text="Hapus Produk"/>
                    </StackPanel>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*"/>
                    <RowDefinition Height="3*"/>
                </Grid.RowDefinitions>

                <GroupBox Header="Daftar Produk" Grid.Row="0">
                    <ListView x:Name="ProductsListView" SelectionChanged="ProductsListView_SelectionChanged">
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Tandai untuk: Detail" Click="MarkToDo_Click" Tag="Detail"/>
                                <MenuItem Header="Tandai untuk: Satuan" Click="MarkToDo_Click" Tag="Satuan"/>
                                <MenuItem Header="Tandai untuk: Stok" Click="MarkToDo_Click" Tag="Stok"/>
                            </ContextMenu>
                        </ListView.ContextMenu>
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Status" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="⚠️" Foreground="OrangeRed" FontSize="16" FontWeight="Bold" HorizontalAlignment="Center"
                                                       Visibility="{Binding IsLowOnStock, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Tugas" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="📝" FontSize="16" HorizontalAlignment="Center"
                                                       Visibility="{Binding HasToDo, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Nama Produk" DisplayMemberBinding="{Binding ProductName}" Width="220"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </GroupBox>

                <Border x:Name="ProductDetailBorder" Grid.Row="1" BorderBrush="DodgerBlue" BorderThickness="2" CornerRadius="3" Margin="0,10,0,0">
                    <GroupBox Header="Detail Produk (Satuan Dasar)">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="ProductDetailPanel" IsEnabled="False" Margin="5" GotFocus="EditorPanel_GotFocus">
                                <Label Content="Nama Produk:"/>
                                <TextBox x:Name="ProductNameTextBox" Margin="0,0,0,10"/>
                                <Label Content="Nama Alternatif (pisahkan dengan koma):"/>
                                <TextBox x:Name="AlternateNamesTextBox" Margin="0,0,0,10" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Height="40"/>
                                <Label Content="Harga Awal (Modal):"/>
                                <TextBox x:Name="CostPriceTextBox" Margin="0,0,0,10"/>
                                <Label Content="Rincian Stok:"/>
                                <TextBlock x:Name="StockBreakdownTextBlock" Text="-" FontWeight="Bold" FontSize="14" Margin="5,0,0,10" TextWrapping="Wrap"/>
                                <Label Content="Notifikasi Stok Kurang Dari:"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="WarningStockLevelTextBox" Width="60"/>
                                    <ComboBox x:Name="WarningStockUnitComboBox" Width="100" Margin="5,0,0,0" DisplayMemberPath="UnitName" SelectedValuePath="UnitID"/>
                                </StackPanel>
                                <Button x:Name="ViewToDoButton" Content="Lihat Tugas untuk Produk Ini" Margin="0,15,0,0" Click="ViewToDoButton_Click"/>
                            </StackPanel>
                        </ScrollViewer>
                    </GroupBox>
                </Border>
            </Grid>

            <DockPanel Grid.Column="1" Margin="10,0,0,0">
                <GroupBox Header="Satuan &amp; Konversi Harga" DockPanel.Dock="Top">
                    <DataGrid x:Name="ConversionsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" 
                              ItemsSource="{Binding ConversionsList}" Height="200" SelectionChanged="ConversionsDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Stok Saja" Binding="{Binding IsStockOnly}" Width="70"/>
                            <DataGridTextColumn Header="Satuan" Binding="{Binding UnitName}" Width="*" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Isi per Satuan" Binding="{Binding ConversionFactor}" Width="100"/>
                            <DataGridTextColumn Header="Harga Jual" Binding="{Binding SellingPrice, StringFormat=C, ConverterCulture=id-ID}" Width="120"/>
                            <DataGridTextColumn Header="Harga Modal" Binding="{Binding CostPrice, StringFormat=C, ConverterCulture=id-ID}" Width="120"/>
                            <DataGridTextColumn Header="Barcode" Binding="{Binding Barcode}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border x:Name="UnitEditorBorder" Grid.Column="0" BorderBrush="Transparent" BorderThickness="2" CornerRadius="3" Margin="0,0,5,0">
                        <GroupBox Grid.Column="0" Header="Tambah/Ubah Satuan">
                            <StackPanel IsEnabled="{Binding ElementName=ProductDetailPanel, Path=IsEnabled}" GotFocus="EditorPanel_GotFocus">
                                <Label Content="Pilih Satuan:"/>
                                <ComboBox x:Name="UnitsComboBox" DisplayMemberPath="UnitName" SelectedValuePath="UnitID"/>
                                <Label Content="Isi per Satuan (Konversi):"/>
                                <TextBox x:Name="FactorTextBox"/>
                                <Label Content="Harga Jual untuk Satuan ini:"/>
                                <TextBox x:Name="PriceTextBox"/>
                                <Label Content="Harga Modal untuk Satuan ini (Opsional):"/>
                                <TextBox x:Name="UnitCostPriceTextBox"/>
                                <Label Content="Barcode untuk Satuan ini (Opsional):"/>
                                <TextBox x:Name="UnitBarcodeTextBox"/>
                                <CheckBox x:Name="IsStockOnlyCheckBox" Content="Hanya untuk Stok (Tidak Dijual)" Margin="0,10,0,0" Checked="IsStockOnlyCheckBox_Changed" Unchecked="IsStockOnlyCheckBox_Changed"/>
                                <Button x:Name="AddUnitButton" Content="Tambah/Update Satuan" Margin="0,10,0,0" Click="AddUnitButton_Click"/>
                                <Button x:Name="RemoveUnitButton" Content="Hapus Satuan Terpilih" Margin="0,5,0,0" Background="IndianRed" Click="RemoveUnitButton_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </Border>

                    <Border x:Name="StockEditorBorder" Grid.Column="1" BorderBrush="Transparent" BorderThickness="2" CornerRadius="3" Margin="5,0,0,0">
                        <GroupBox Grid.Column="1" Header="Manajemen Stok">
                            <StackPanel IsEnabled="{Binding ElementName=ProductDetailPanel, Path=IsEnabled}" GotFocus="EditorPanel_GotFocus">
                                <Label Content="Tambah Stok:"/>
                                <TextBox x:Name="AddStockQuantityTextBox" Margin="0,0,0,5" ToolTip="Jumlah"/>
                                <ComboBox x:Name="AddStockUnitComboBox" Margin="0,0,0,5" ToolTip="Pilih Satuan" DisplayMemberPath="UnitName"/>
                                <Button x:Name="AddStockButton" Content="Tambahkan Stok" Click="AddStockButton_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </Border>
                </Grid>
            </DockPanel>
        </Grid>
    </DockPanel>
</Window>
